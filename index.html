<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>abrat</title>
<script src="./vendor/jquery.js"></script>
<link rel="stylesheet" type="text/css" href="./vendor/bootstrap.css" />
<script>
    var PATCH = {};
    var $ABRAT = {
        ns : PATCH, //defaults to $ABRAT 
        //cookieName : '', //defaults to abtests
        experiments : [
            {'key' : 'cl',
             'name' : 'primary vs ino',
             'weight' : 60 }, // persentage of a 50% if skipped only in increments of 10s will be rounded
            {'key' : 'ba',
             'name' : 'large vs small',
             'weight' : 40 },
            {'key' : 'sh',
             'name' : 'wonderful vs lovely'}
        ],
    };
</script>
</head>

<body id="index" class="home">

    <!-- for simple --> 
    <script src="./src/abrat.js"></script>

    <!-- for optimized pages one less http request  -->
    <script>
        (function(){var j=$ABRAT.ns||$ABRAT,i={},k=$ABRAT.cookieName||"abtests",l=function(){var g=[],f;for(f in $ABRAT.experiments)if($ABRAT.experiments.hasOwnProperty(f)){var a=$ABRAT.experiments[f];if(!a.weight)a.weight=50;i[a.key]=a.name;g.push(a.key+parseInt(Math.round(a.weight/10),10))}return g.join("-")}();if(!String.prototype.trim)String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};var m=function(g){var f=null;if(document.cookie&&""!=document.cookie)for(var a=document.cookie.split(";"),
        h=0;h<a.length;h++){var c=a[h].trim();if(c.substring(0,g.length+1)==g+"="){f=decodeURIComponent(c.substring(g.length+1).replace(/\+/g," "));break}}return f};j.ab=function(){var g=function(c){var b={};if(c){var c=c.split("-"),a;for(a in c)c.hasOwnProperty(a)&&(b[c[a].slice(0,-1)]=parseInt(c[a].slice(-1),10))}return b},f=g(l),a=g(m(k)),h=function(a){var b=Math.ceil(10*Math.random());arguments.length||(a=5);return a<=b?0:1};return{report:function(c){var b={},e;for(e in a)a.hasOwnProperty(e)&&(b[i[e]]=
        ["a","b"][a[e]]);return c(b)},attachHandlers:function(c){var b,e,d;for(d in a)a.hasOwnProperty(d)&&(b=["a","b"][a[d]],e=d+"-"+b,b=i[d]+" ("+b+")",c(e,b))},init:function(){var c="",b;for(b in f)if(f.hasOwnProperty(b)){var e;"undefined"!==typeof a[b]?e=["a","b"][a[b]]:(e=["a","b"][h(f[b])],a[b]=["a","b"].indexOf(e));document.body.className+=" "+b+"-"+e;c+="body."+b+"-a ."+b+"-b { display: none !important }";c+="body."+b+"-b ."+b+"-a { display: none !important }"}var d;b="";for(d in a)a.hasOwnProperty(d)&&
        (b+=d+a[d]+"-");d=b.slice(0,-1);document.cookie=k+"="+encodeURIComponent(d);d=document.createElement("style");d.setAttribute("type","text/css");d.styleSheet?d.styleSheet.cssText=c:d.appendChild(document.createTextNode(c));document.getElementsByTagName("head")[0].appendChild(d)}}}();j.ab.init()})();
    </script>

    <script>
        PATCH.ab.attachHandlers(function(sel,name){
            $(function(){
                // for older than 1.7 use
                //$('body .' + sel).delegate('a','mousedown', function() {
                $('body .' + sel).on('mousedown', 'a', function(e) {
                    // report that abrat element was clicked
                    _gaq.push(['_trackEvent', name, 'clicked']);
                    $('#console').append($('<li>').html(name + " : clicked"));
                });
                // just for debugging 
                $('body .' + sel).on('click', 'a', function(e) {
                    e.preventDefault();
                });
            });
        });
    </script>
    <script type="text/javascript">

    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-565491-13']);
    // report abrat stuff to google analytics
                             // | which custom var                // | scope visitor level
    var experiments = PATCH.ab.report(function(abhash){
        return $.map(abhash, function(v,k){
            _gaq.push(['_trackEvent', k+" ("+v+")", 'loaded']);
            return k+" ("+v+")"
        }).join(" | ");
    });
    _gaq.push(['_setCustomVar', 1, 'Experiments', experiments, 1]);
    // end abrat stuff
    _gaq.push(['_trackPageview']);

    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

    $(function(){
        $('#console').append($('<li>').html(experiments));
        $('#deleteCookie').click(function(e){
            var name = $ABRAT.cookieName || 'abtests';
            document.cookie = name + '=; expires=Thu, 01-Jan-70 00:00:01 GMT;';
            e.preventDefault();
        });
    });

    </script>
    <div class="topbar" data-scrollspy="scrollspy">
      <div class="topbar-inner">
        <div class="container">
          <a class="brand" href="">ABrat</a>
          <ul class="nav">
            <li class="active"><a href="#overview">Overview</a></li>
            <li><a href="#docs">Documentation</a></li>
          </ul>
        </div>
      </div>
    </div>
    <div class="container-fluid" style="margin-top: 50px">
        <div class="sidebar">
            <a id="deleteCookie" class="btn small danger" href="">Delete Cookie</a>
            <h4>Reported</h4>
            <ul id="console">
            </ul>
        </div>
        <div class="content">
            <h1>ABrat <small>a cache tolerant ab switch</small></h1>
            <img height="300" width="582" src="img/gray-rat.jpg" />

            <section id="overview">
            <div class="page-header">
                <h1>Overview <small>what the hell is this thing</small></h1>
            </div>
            <h2>Button Style Tests</h2>
            <p>Lets say that we want to have a button for users to click on
            and we want to make sure we pick the button that performs the
            best</p>
            <p>We are considering two options the<br/>
                <a class="btn large info" href="">info style</a>
                <br/>vs.<br/>
                <a class="btn large primary" href="">primary style</a>
                <br/> button
            </p>
            <p>We can simply just ab test it:
                <span class="cl-a"><a class="btn large info" href="">now
                        running info</a></span>
                <span class="cl-b"><a class="btn large primary" href="">now
                        running primary</a></span>
            </p>
            <hr />

            <h2>Button Style Tests</h2>
            <p>Now lets say we have concluded that the primary button performs
            better and we want to see if size matters then we can simply
            test:<br/>
                <a class="btn large primary" href="">large primary</a>
                <br/>vs.</br>
                <a class="btn small primary" href="">small primary</a>
            </p>
            <p>Now we test size:
                <span class="ba-a"><a class="btn large primary" href="">now running large</a></span>
                <span class="ba-b"><a class="btn small primary" href="">now running small</a></span></p>

            <hr />
            <h2>Verbiage Tests</h2>
            <p>Lets say we are testing different wordings on links to see what works.</p>
            <p><a href="">Lovely</a> vs. <a href="">Wonderful</a></p>
            <p>Now we can test it:
                <span class="sh-a"><a href="">Lovely</a></span>
                <span class="sh-b"><a href="">Wonderful</a></span></p>

            </section>
            <section id="docs">
                <div class="page-header">
                    <h1>Documentation <small>how the hell does this thing work</small></h1>
                </div>
                <h2>Configuration</h2>
                <p>Configuration object can be set early on in the header. It's always a good idea to have a good name space that 
                   organize your page utilities. This can be passed in so one doesn't have to use $ABRAT constance but rather your
                   own and access things through the ab attribute. In the excample we'll use PATCH since this was developed at 
                   <a href='http://patch.com'>patch.com</a></p>
                <code>
                  <pre>
    var PATCH = {};
    var $ABRAT = {
        ns : PATCH, //defaults to $ABRAT 
        //cookieName : '', //defaults to abtests
        experiments : [
            {'key' : 'cl',
            'name' : 'primary vs ino',
            'weight' : 60 }, // persentage of a 50% if skipped only in increments of 10s will be rounded
            {'key' : 'ba',
            'name' : 'large vs small',
            'weight' : 40 },
            {'key' : 'sh',
            'name' : 'wonderful vs lovely'}
        ],
    };
                  </pre>
                </code>
                <p>Then right after the body opens slap in the abrat javascript code either by inlining or requiring the javascript file<p>
                <code>
                <pre>
    &lt;!-- for simple --> 
    &lt;script src="./src/abrat.js"&gt;&lt;/script&gt;
                  </pre>
                </code>
                <p>or</p>
                <code>
                <pre>

    &lt;!-- for optimized pages one less http request  -->
    &lt;script&gt;
(function(){var j=$ABRAT.ns||$ABRAT,i={},k=$ABRAT.cookieName||"abtests",...
    &lt;/script&gt;
                </pre>
                </code>
                <h2>Page Level Reporting</h2>
                <p>Now after this business you have two more things to cover.
                One is to report to your reporting suite I use google
                analytics here. The abrat has a concept of a report which you
                pass in anonmous function which gets a hash passed in which
                you can do things with. Here I aggregate all experiments and
                which variant was is rendered into a | sparated string. I also
                push a trackEvent indicating that experiments have been
                loaded. How you implement this highly depends on your report
                suite and how you use it.</p>
                <code><pre>
    var experiments = PATCH.ab.report(function(abhash){
        return $.map(abhash, function(v,k){
            _gaq.push(['_trackEvent', k+" ("+v+")", 'loaded']);
            return k+" ("+v+")"
        }).join(" | ");
    });
    _gaq.push(['_setCustomVar', 1, 'Experiments', experiments, 1]);
                </pre></code>
                <h2>Action Level Reporting</h2>
                <p>Next, we probably want to messure any interactions on
                things in our experiments ... so there is an ability to attach
                handlers on elements in those dom nodes that are being
                experimented with</p>
                <code><pre>
        PATCH.ab.attachHandlers(function(sel,name){
            $(function(){
                $('body .' + sel).on('mousedown', 'a', function(e) {
                    // report that abrat element was clicked
                    _gaq.push(['_trackEvent', name, 'clicked']);
                });
            });
        });
                </pre></code>
                <p>Again all depends on how you want to implement this
                stuff, after all abrat does nothing but the switching.</p>
            </section>
        </div>
    </div>
</body>
</html>
